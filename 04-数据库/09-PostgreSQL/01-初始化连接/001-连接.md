---
createTime: 2025-06-06
---
## 安装psql客户端

使用 yum 安装 psql 客户端

```sh
yum search postgresql

# 这是在公司的服务器内安装的，外面估计不是这个
yum install -y postgresql.x86_64
```

查看 psql 版本

```sh
psql --version
# psql (PostgreSQL) 9.2.24
```


## 常用SQL

登录金仓数据库
```
10.6.74.34:55432
mppadmin/kingbase@kadb
database:ods

psql -h 10.6.74.134 -p 55432 -U mppadmin -d ods

PGPASSWORD="kingbase@kadb" psql -h 10.6.74.134 -p 55432 -U mppadmin -d ods
```

- 连接到数据库：`psql -U username -d dbname -h host -p port`
- 退出psql：`\q` 或 `Ctrl+D`
- 列出所有数据库：`\l` 或 `SELECT datname FROM pg_database;`
![](images/Pasted%20image%2020250606133818.png)
- 切换数据库：`\c dbname`
- 创建数据库：`CREATE DATABASE dbname;`
- 删除数据库：`DROP DATABASE dbname;`
- 列出当前数据库中的所有表：`\dt`
- 列出所有表（包括系统表）：`\dt *.*`
![](images/Pasted%20image%2020250606133932.png)
- 查看表结构：`\d tablename`
- 查看表的详细结构（包括约束、索引等）：`\d+ tablename`
- 查看表的创建语句：`\dD tablename` 或 `\d+ tablename`
- 列出所有模式：`\dn`
![](images/Pasted%20image%2020250606133907.png)
- 执行SQL查询：直接输入SQL语句，如 `SELECT * FROM tablename;`
![](images/Pasted%20image%2020250606134120.png)
- 显示查询历史：`\s`
- 执行外部SQL文件：`\i filename.sql`
- 列出所有用户：`\du`
![](images/Pasted%20image%2020250606134053.png)
- 创建用户：`CREATE USER username WITH PASSWORD 'password';`
- 修改用户密码：`ALTER USER username WITH PASSWORD 'newpassword';`
- 导出表数据：`\copy tablename TO '/path/to/file.csv' WITH CSV HEADER`
- 导入数据到表：`\copy tablename FROM '/path/to/file.csv' WITH CSV HEADER`

## 导入SQL文件

直接命令导入

sql 文件位置：`/data/apps/ora2pg/oracle_data/O_LIS_LCCONT_DATA.sql`

```sh
PGPASSWORD="kingbase@kadb" psql -h 10.6.74.134 -p 55432 -U mppadmin -d ods -v ON_ERROR_STOP=0 -f /data/apps/ora2pg/oracle_data/O_LIS_LCCONT_O_LIS_LCCONT.sql 
```


添加参数 `-v ON_ERROR_STOP=0 ` 容错模式


### 定时查询一张表

```sh
watch -n 5 'PGPASSWORD="kingbase@kadb" psql -h 10.6.74.134 -p 55432 -U mppadmin -d ods -c "select count(0) from public.o_lis_lccont"'
```



### 找到有问题的换行符

```sh
grep '^\\\.$' O_LIS_LCCONT_O_LIS_LCCONT_2.sql | wc -l
```

替换

```sh
awk '!/^\\\.$/' O_LIS_LCCONT_O_LIS_LCCONT_2.sql > O_LIS_LCCONT_O_LIS_LCCONT_3.sql
```